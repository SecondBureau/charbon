// China India Dialogue

- if category  = current_site.categories.where(slug: slug).first
  
  - posts     = category.posts.joins("LEFT OUTER JOIN cama_metas ON cama_metas.objectid = cama_posts.id AND cama_metas.object_class = 'Post' AND cama_metas.key = 'enabled_languages'").published.where("(#{CamaleonCms::Post.table_name}.published_at is not null and #{CamaleonCms::Post.table_name}.published_at <= ?)", Time.now).where("visibility != 'private'").where('cama_metas.value is null or cama_metas.value like ?', "%#{current_locale}%").reorder(published_at: :desc).limit(count)
  
  .home-block
  
    - if posts.count > 0
      - template = 'std' unless local_assigns.has_key?(:template)
      - thumbnail = false unless local_assigns.has_key?(:thumbnail)
      - color = '' unless local_assigns.has_key?(:color)
      - css = '' unless local_assigns.has_key?(:css)
      - rows = 1 unless local_assigns.has_key?(:rows)
      = render partial: theme_view("blocks/#{template}"), locals: {posts: posts.to_a, thumbnail: thumbnail, color: color, category: category.decorate, css: css, rows: rows}
    - else
      No post yet